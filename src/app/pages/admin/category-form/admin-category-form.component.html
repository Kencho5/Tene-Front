<div class="space-y-5">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-xl font-semibold text-platinum-100">
        {{ pageTitle() }}
      </h1>
      <p class="mt-0.5 text-sm text-platinum-50">
        @if (isEditMode()) {
          კატეგორიის ID: {{ categoryId() }}
        } @else {
          შეავსეთ ყველა სავალდებულო ველი
        }
      </p>
    </div>
  </div>

  <!-- Form -->
  <form (submit)="onSubmit($event)" novalidate class="space-y-5">
    <!-- Basic Information Card -->
    <div class="rounded-lg border border-platinum-20 bg-white p-5">
      <h2 class="mb-4 text-sm font-semibold uppercase tracking-wider text-platinum-50">
        ძირითადი ინფორმაცია
      </h2>

      <div class="flex flex-col gap-4">
        <!-- Category Name -->
        <app-input
          [formField]="categoryForm.name"
          [error]="submitted() && categoryForm.name().invalid()"
          type="text"
          placeholder="კატეგორიის სახელი *"
          (input)="onNameInput($event)"
        />

        <!-- Slug -->
        <app-input
          [formField]="categoryForm.slug"
          [error]="submitted() && categoryForm.slug().invalid()"
          type="text"
          placeholder="სლაგი (URL) *"
        />

        <!-- Parent Category -->
        <div>
          <label class="mb-1.5 block text-sm font-medium text-platinum-70">
            მშობელი კატეგორია
          </label>
          <app-combobox
            [selectedValue]="selectedParentValue()"
            (selectedValueChange)="onParentCategoryChange($event)"
            [items]="categoryOptions()"
            placeholder="აირჩიეთ მშობელი კატეგორია"
            searchPlaceholder="ძიება..."
            notFoundText="კატეგორია ვერ მოიძებნა"
          />
        </div>

        <!-- Description -->
        <textarea
          [formField]="categoryForm.description"
          rows="4"
          placeholder="კატეგორიის დეტალური აღწერა (სურვილისამებრ)"
          class="w-full resize-none rounded-lg border border-platinum-20 bg-white px-3.5 py-2.5 text-sm text-platinum-100 placeholder:text-platinum-40 outline-none focus:border-platinum-40 focus:ring-1 focus:ring-platinum-40"
        ></textarea>

        <!-- Category Image -->
        <div>
          <label class="mb-1.5 block text-sm font-medium text-platinum-70">
            კატეგორიის სურათი
          </label>

          @if (imagePreview()) {
            <div class="relative mb-3 w-full max-w-xs">
              <img
                [src]="imagePreview()"
                alt="Category preview"
                class="h-48 w-full rounded-lg border border-platinum-20 object-cover"
              />
              <button
                type="button"
                (click)="removeImage()"
                class="absolute right-2 top-2 flex h-7 w-7 items-center justify-center rounded-full bg-valencia-60 text-white transition-opacity hover:bg-valencia-70"
                aria-label="წაშლა"
              >
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                  <path
                    d="M12 4L4 12M4 4L12 12"
                    stroke="currentColor"
                    stroke-width="1.5"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </div>
          } @else {
            <label
              for="category-image"
              class="flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed border-platinum-20 bg-platinum-10 px-6 py-8 transition-colors hover:border-green-60 hover:bg-green-10"
            >
              <svg
                width="40"
                height="40"
                viewBox="0 0 48 48"
                fill="none"
                class="mb-3 text-platinum-40"
              >
                <path
                  d="M24 32V16M16 24H32M42 24C42 33.9411 33.9411 42 24 42C14.0589 42 6 33.9411 6 24C6 14.0589 14.0589 6 24 6C33.9411 6 42 14.0589 42 24Z"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                />
              </svg>
              <p class="mb-1 text-sm font-medium text-platinum-70">
                დააჭირეთ სურათის ასატვირთად
              </p>
              <p class="text-xs text-platinum-50">PNG, JPG, WEBP (მაქს. 5MB)</p>
            </label>
            <input
              id="category-image"
              type="file"
              accept="image/*"
              (change)="onImageSelect($event)"
              class="hidden"
            />
          }
        </div>

        <!-- Display Order -->
        <app-input
          [formField]="categoryForm.display_order"
          type="number"
          placeholder="ჩვენების რიგი"
        />

        <!-- Enabled Toggle -->
        <div class="flex items-center justify-between rounded-lg border border-platinum-20 bg-platinum-10/50 p-4">
          <div>
            <p class="text-sm font-medium text-platinum-100">სტატუსი</p>
            <p class="text-xs text-platinum-50">
              გააქტიურებული კატეგორია გამოჩნდება საიტზე
            </p>
          </div>
          <button
            type="button"
            (click)="toggleEnabled()"
            class="relative inline-flex h-[22px] w-10 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-60 focus:ring-offset-2"
            [class.bg-green-60]="categoryModel().enabled"
            [class.bg-platinum-30]="!categoryModel().enabled"
            [attr.aria-label]="categoryModel().enabled ? 'გამორთვა' : 'ჩართვა'"
          >
            <span
              class="inline-block h-4 w-4 transform rounded-full bg-white shadow-sm transition-transform"
              [class.translate-x-[21px]]="categoryModel().enabled"
              [class.translate-x-[3px]]="!categoryModel().enabled"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="flex items-center justify-end gap-3">
      <button
        type="button"
        (click)="cancel()"
        class="rounded-lg border border-platinum-20 px-5 py-2 text-sm font-medium text-platinum-60 transition-colors hover:bg-platinum-10"
      >
        გაუქმება
      </button>
      <button
        type="submit"
        [disabled]="isLoading()"
        [class]="
          'inline-flex items-center gap-1.5 rounded-lg px-5 py-2 text-sm font-medium text-white transition-colors ' +
          (isLoading()
            ? 'cursor-not-allowed bg-platinum-40'
            : 'bg-green-60 hover:bg-green-70')
        "
      >
        @if (isLoading()) {
          <svg
            width="15"
            height="15"
            viewBox="0 0 16 16"
            fill="none"
            class="animate-spin"
          >
            <path
              d="M8 2V4M8 12V14M14 8H12M4 8H2M12.2426 3.75736L10.8284 5.17157M5.17157 10.8284L3.75736 12.2426M12.2426 12.2426L10.8284 10.8284M5.17157 5.17157L3.75736 3.75736"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            />
          </svg>
          <span>მუშავდება...</span>
        } @else {
          <span>{{ isEditMode() ? "განახლება" : "დამატება" }}</span>
        }
      </button>
    </div>
  </form>
</div>
