<div class="space-y-6">
  <!-- Header -->
  <div
    class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"
  >
    <div>
      <h1 class="text-2xl font-semibold text-platinum-100">პროდუქტები</h1>
      <p class="mt-1 text-sm text-platinum-50">
        სულ {{ totalProducts() }} პროდუქტი
      </p>
    </div>

    <a
      [routerLink]="['/admin/products/new']"
      class="flex items-center justify-center gap-2 rounded-xl bg-green-60 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-green-70"
    >
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path
          d="M8 3.33337V12.6667M3.33334 8.00004H12.6667"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
        />
      </svg>
      ახალი პროდუქტი
    </a>
  </div>

  <!-- Filters Bar -->
  <div
    class="flex flex-col gap-3 rounded-xl border border-platinum-20 bg-white p-4 sm:flex-row sm:items-center"
  >
    <!-- Search Input -->
    <div class="relative flex-1">
      <svg
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
        class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-platinum-50"
      >
        <path
          d="M16.6653 16.6667L13.4431 13.4445M15.1839 9.2593C15.1839 12.5321 12.5308 15.1852 9.25795 15.1852C5.98516 15.1852 3.33203 12.5321 3.33203 9.2593C3.33203 5.9865 5.98516 3.33337 9.25795 3.33337C12.5308 3.33337 15.1839 5.9865 15.1839 9.2593Z"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <input
        type="text"
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        placeholder="ძიება პროდუქტის სახელით ან ID-ით..."
        class="h-[44px] w-full rounded-xl border border-platinum-20 py-2.5 pl-10 pr-10 text-sm outline-none transition-colors focus:border-green-60 focus:ring-1 focus:ring-green-60"
      />
      @if (searchQuery()) {
        <button
          type="button"
          (click)="clearSearch()"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-platinum-50 transition-colors hover:text-platinum-100"
        >
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path
              d="M12 4L4 12M4 4L12 12"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            />
          </svg>
        </button>
      }
    </div>

    <!-- Sort Dropdown -->
    <div class="w-full sm:w-[220px]">
      <app-dropdown
        [selectedValue]="params()['sort_by']"
        (selectedValueChange)="onSortChange($event)"
        placeholder="სორტირება"
        [items]="sortOptions"
      />
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-hidden rounded-xl border border-platinum-20 bg-white">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="border-b border-platinum-20 bg-platinum-10">
          <tr>
            <th
              class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wide text-platinum-60"
            >
              პროდუქტი
            </th>
            <th
              class="hidden px-4 py-3 text-left text-xs font-medium uppercase tracking-wide text-platinum-60 md:table-cell"
            >
              კატეგორია
            </th>
            <th
              class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wide text-platinum-60"
            >
              ფასი
            </th>
            <th
              class="hidden px-4 py-3 text-left text-xs font-medium uppercase tracking-wide text-platinum-60 lg:table-cell"
            >
              მარაგი
            </th>
            <th
              class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wide text-platinum-60"
            >
              მოქმედებები
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-platinum-20">
          @if (isLoading()) {
            @for (skeleton of [1, 2, 3, 4, 5]; track skeleton) {
              <tr class="hover:bg-platinum-10">
                <td class="px-4 py-4">
                  <div class="flex items-center gap-3">
                    <div
                      class="h-12 w-12 animate-pulse rounded-xl bg-platinum-20"
                    ></div>
                    <div class="space-y-2">
                      <div
                        class="h-4 w-32 animate-pulse rounded bg-platinum-20"
                      ></div>
                      <div
                        class="h-3 w-20 animate-pulse rounded bg-platinum-20"
                      ></div>
                    </div>
                  </div>
                </td>
                <td class="hidden px-4 py-4 md:table-cell">
                  <div
                    class="h-4 w-28 animate-pulse rounded bg-platinum-20"
                  ></div>
                </td>
                <td class="px-4 py-4">
                  <div
                    class="h-4 w-16 animate-pulse rounded bg-platinum-20"
                  ></div>
                </td>
                <td class="hidden px-4 py-4 lg:table-cell">
                  <div
                    class="h-4 w-12 animate-pulse rounded bg-platinum-20"
                  ></div>
                </td>
                <td class="px-4 py-4">
                  <div class="flex justify-end gap-2">
                    <div
                      class="h-8 w-8 animate-pulse rounded-xl bg-platinum-20"
                    ></div>
                    <div
                      class="h-8 w-8 animate-pulse rounded-xl bg-platinum-20"
                    ></div>
                  </div>
                </td>
              </tr>
            }
          } @else if (products().length === 0) {
            <tr>
              <td colspan="6" class="px-4 py-16 text-center">
                <div class="flex flex-col items-center gap-3">
                  <svg
                    width="48"
                    height="48"
                    viewBox="0 0 48 48"
                    fill="none"
                    class="text-platinum-30"
                  >
                    <path
                      d="M42 30V18L24 9L6 18V30L24 39L42 30Z"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M6 18L24 27L42 18M24 39V27"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <div>
                    <p class="text-sm font-medium text-platinum-100">
                      პროდუქტები არ მოიძებნა
                    </p>
                    <p class="mt-1 text-sm text-platinum-50">
                      სცადეთ სხვა ძებნის პარამეტრები
                    </p>
                  </div>
                </div>
              </td>
            </tr>
          } @else {
            @for (product of products(); track product.data.id) {
              <tr class="transition-colors hover:bg-platinum-10">
                <!-- Product -->
                <td class="px-4 py-4">
                  <div class="flex items-center gap-3">
                    @if (getProductImage(product)) {
                      <div
                        class="h-12 w-12 overflow-hidden rounded-xl border border-platinum-20"
                      >
                        <img
                          [src]="getProductImage(product)"
                          [alt]="product.data.name"
                          class="h-full w-full object-cover"
                        />
                      </div>
                    } @else {
                      <div
                        class="flex h-12 w-12 items-center justify-center rounded-xl border border-platinum-20 bg-platinum-10"
                      >
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          class="text-platinum-40"
                        >
                          <path
                            d="M21 15V9L12 4.5L3 9V15L12 19.5L21 15Z"
                            stroke="currentColor"
                            stroke-width="1.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                      </div>
                    }
                    <div>
                      <a
                        [routerLink]="getProductLink(product)"
                        class="font-medium text-platinum-100 hover:text-green-60 transition-colors"
                      >
                        {{ product.data.name }}
                      </a>
                      <p class="text-sm text-platinum-50">
                        ID: {{ product.data.id }}
                      </p>
                    </div>
                  </div>
                </td>

                <!-- Category -->
                <td class="hidden px-4 py-4 md:table-cell">
                  <span
                    class="inline-flex rounded-full bg-platinum-10 px-2.5 py-1 text-xs font-medium text-platinum-100"
                  >
                    {{ product.data.product_type || "-" }}
                  </span>
                </td>

                <!-- Price -->
                <td class="px-4 py-4">
                  <div class="space-y-1">
                    @if (product.data.discount > 0) {
                      <p class="font-semibold text-platinum-100">
                        {{
                          product.data.price * (1 - product.data.discount / 100)
                            | number: "1.2-2"
                        }}
                        ₾
                      </p>
                      <p class="text-xs text-platinum-50 line-through">
                        {{ product.data.price }} ₾
                      </p>
                    } @else {
                      <p class="font-semibold text-platinum-100">
                        {{ product.data.price }} ₾
                      </p>
                    }
                  </div>
                </td>

                <!-- Stock -->
                <td class="hidden px-4 py-4 lg:table-cell">
                  <div class="flex items-center gap-2">
                    @if (product.data.quantity > 0) {
                      <span
                        class="inline-flex h-6 min-w-[32px] items-center justify-center rounded-full bg-green-10 px-2 text-xs font-medium text-green-70"
                      >
                        {{ product.data.quantity }}
                      </span>
                    } @else {
                      <span
                        class="inline-flex h-6 min-w-[32px] items-center justify-center rounded-full bg-valencia-10 px-2 text-xs font-medium text-valencia-60"
                      >
                        0
                      </span>
                    }
                  </div>
                </td>

                <!-- Actions -->
                <td class="px-4 py-4">
                  <div class="flex items-center justify-end gap-2">
                    <a
                      [routerLink]="['/admin/products', product.data.id, 'edit']"
                      class="flex items-center justify-center rounded-xl p-2 text-platinum-60 transition-colors hover:bg-platinum-10 hover:text-platinum-100"
                      aria-label="რედაქტირება"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                      >
                        <path
                          d="M11.3333 2.00004C11.5084 1.82494 11.7163 1.68605 11.9451 1.59129C12.1739 1.49653 12.419 1.44775 12.6666 1.44775C12.9143 1.44775 13.1594 1.49653 13.3882 1.59129C13.617 1.68605 13.8249 1.82494 14 2.00004C14.1751 2.17513 14.314 2.383 14.4087 2.61178C14.5035 2.84055 14.5523 3.08569 14.5523 3.33337C14.5523 3.58106 14.5035 3.8262 14.4087 4.05497C14.314 4.28375 14.1751 4.49162 14 4.66671L5.00001 13.6667L1.33334 14.6667L2.33334 11L11.3333 2.00004Z"
                          stroke="currentColor"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </a>
                    <button
                      type="button"
                      (click)="openDeleteModal(product.data.id)"
                      class="rounded-xl p-2 text-platinum-60 transition-colors hover:bg-valencia-10 hover:text-valencia-60"
                      aria-label="წაშლა"
                    >
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 16 16"
                        fill="none"
                      >
                        <path
                          d="M2 4H3.33333H14"
                          stroke="currentColor"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                        <path
                          d="M5.33334 4.00004V2.66671C5.33334 2.31309 5.47381 1.97395 5.72386 1.7239C5.97391 1.47385 6.31305 1.33337 6.66668 1.33337H9.33334C9.68697 1.33337 10.0261 1.47385 10.2762 1.7239C10.5262 1.97395 10.6667 2.31309 10.6667 2.66671V4.00004M12.6667 4.00004V13.3334C12.6667 13.687 12.5262 14.0261 12.2762 14.2762C12.0261 14.5262 11.687 14.6667 11.3333 14.6667H4.66668C4.31305 14.6667 3.97391 14.5262 3.72386 14.2762C3.47381 14.0261 3.33334 13.687 3.33334 13.3334V4.00004H12.6667Z"
                          stroke="currentColor"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <app-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages()"
      [totalItems]="totalProducts()"
      [showingFrom]="showingFrom()"
      [showingTo]="showingTo()"
      [limit]="limit()"
      (pageChange)="onPageChange($event)"
      (limitChange)="onLimitChangeValue($event)"
    />
  </div>
</div>

<app-confirmation-modal
  [isOpen]="isDeleteModalOpen()"
  title="პროდუქტის წაშლა"
  message="დარწმუნებული ხართ, რომ გსურთ ამ პროდუქტის წაშლა? ეს მოქმედება შეუქცევადია."
  confirmText="წაშლა"
  cancelText="გაუქმება"
  confirmButtonGradientStart="#ef4444"
  confirmButtonGradientEnd="#dc2626"
  (confirm)="confirmDelete()"
  (cancel)="closeDeleteModal()"
/>
