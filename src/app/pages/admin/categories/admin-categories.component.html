<div class="space-y-5">
  <!-- Header -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h1 class="text-xl font-semibold text-platinum-100">კატეგორიები</h1>
      <p class="mt-0.5 text-sm text-platinum-50">
        სულ {{ totalCategories() }} კატეგორია
      </p>
    </div>

    <a
      [routerLink]="['/admin/categories/new']"
      class="inline-flex items-center justify-center gap-1.5 rounded-lg bg-green-60 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-green-70"
    >
      <svg width="15" height="15" viewBox="0 0 16 16" fill="none">
        <path
          d="M8 3.33337V12.6667M3.33334 8.00004H12.6667"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
        />
      </svg>
      ახალი კატეგორია
    </a>
  </div>

  <!-- Filters -->
  <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
    <!-- Search -->
    <div class="relative flex-1">
      <svg
        width="16"
        height="16"
        viewBox="0 0 20 20"
        fill="none"
        class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-platinum-40"
      >
        <path
          d="M16.6653 16.6667L13.4431 13.4445M15.1839 9.2593C15.1839 12.5321 12.5308 15.1852 9.25795 15.1852C5.98516 15.1852 3.33203 12.5321 3.33203 9.2593C3.33203 5.9865 5.98516 3.33337 9.25795 3.33337C12.5308 3.33337 15.1839 5.9865 15.1839 9.2593Z"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <input
        type="text"
        [value]="searchQuery()"
        (input)="onSearchInput($event)"
        placeholder="ძიება კატეგორიის სახელით ან ID-ით..."
        class="h-10 w-full rounded-lg border border-platinum-20 bg-white py-2 pl-9 pr-9 text-sm text-platinum-100 outline-none transition-colors placeholder:text-platinum-40 focus:border-platinum-40"
      />
      @if (searchQuery()) {
        <button
          type="button"
          (click)="clearSearch()"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-platinum-40 transition-colors hover:text-platinum-70"
        >
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
            <path
              d="M12 4L4 12M4 4L12 12"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            />
          </svg>
        </button>
      }
    </div>

    <!-- Status Filter -->
    <div class="w-full sm:w-[190px]">
      <app-dropdown
        [selectedValue]="params()['enabled'] === 'true' ? 'enabled' : params()['enabled'] === 'false' ? 'disabled' : 'all'"
        (selectedValueChange)="onStatusChange($event)"
        placeholder="სტატუსი"
        [items]="statusOptions"
        [customClass]="'h-[40px]'"
      />
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-hidden rounded-lg border border-platinum-20 bg-white">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-platinum-20">
            <th
              class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-platinum-50"
            >
              კატეგორია
            </th>
            <th
              class="hidden px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-platinum-50 md:table-cell"
            >
              სლაგი
            </th>
            <th
              class="hidden px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-platinum-50 lg:table-cell"
            >
              მშობელი კატეგორია
            </th>
            <th
              class="hidden px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-platinum-50 xl:table-cell"
            >
              სტატუსი
            </th>
            <th
              class="px-4 py-3 text-right text-xs font-medium uppercase tracking-wider text-platinum-50"
            >
              მოქმედებები
            </th>
          </tr>
        </thead>
        <tbody>
          @if (allCategories.isLoading()) {
            @for (skeleton of [1, 2, 3, 4, 5]; track skeleton) {
              <tr class="border-b border-platinum-20 last:border-b-0">
                <td class="px-4 py-3.5">
                  <div class="flex items-center gap-3">
                    <div class="h-11 w-11 animate-pulse rounded-lg bg-platinum-10"></div>
                    <div class="space-y-1.5">
                      <div class="h-4 w-32 animate-pulse rounded bg-platinum-10"></div>
                      <div class="h-3 w-20 animate-pulse rounded bg-platinum-10"></div>
                    </div>
                  </div>
                </td>
                <td class="hidden px-4 py-3.5 md:table-cell">
                  <div class="h-4 w-28 animate-pulse rounded bg-platinum-10"></div>
                </td>
                <td class="hidden px-4 py-3.5 lg:table-cell">
                  <div class="h-4 w-24 animate-pulse rounded bg-platinum-10"></div>
                </td>
                <td class="hidden px-4 py-3.5 xl:table-cell">
                  <div class="h-5 w-9 animate-pulse rounded-full bg-platinum-10"></div>
                </td>
                <td class="px-4 py-3.5">
                  <div class="flex justify-end gap-1">
                    <div class="h-8 w-8 animate-pulse rounded-lg bg-platinum-10"></div>
                    <div class="h-8 w-8 animate-pulse rounded-lg bg-platinum-10"></div>
                  </div>
                </td>
              </tr>
            }
          } @else if (categories().length === 0) {
            <tr>
              <td colspan="5" class="px-4 py-16 text-center">
                <div class="flex flex-col items-center gap-2">
                  <svg
                    width="44"
                    height="44"
                    viewBox="0 0 48 48"
                    fill="none"
                    class="text-platinum-30"
                  >
                    <path
                      d="M6 12C6 9.79086 7.79086 8 10 8H18L22 12H38C40.2091 12 42 13.7909 42 16V36C42 38.2091 40.2091 40 38 40H10C7.79086 40 6 38.2091 6 36V12Z"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <p class="text-sm font-medium text-platinum-70">კატეგორიები არ მოიძებნა</p>
                  <p class="text-xs text-platinum-50">სცადეთ სხვა ძებნის პარამეტრები</p>
                </div>
              </td>
            </tr>
          } @else {
            @for (category of categories(); track category.id) {
              <tr
                class="border-b border-platinum-20 transition-colors last:border-b-0 hover:bg-platinum-10/50"
                [class.opacity-45]="!category.enabled"
                [class.bg-green-10/30]="category.depth === 0"
              >
                <!-- Category Name & Image -->
                <td class="px-4 py-3" [style.box-shadow]="category.depth === 0 ? 'inset 4px 0 0 0 #d1d5db' : ''">
                  <div class="flex items-center gap-3">
                    <!-- Depth indicator with tree lines -->
                    @if (category.depth > 0) {
                      <div class="flex items-center" [style.width.px]="category.depth * 20">
                        @for (level of [].constructor(category.depth); track $index) {
                          @if ($index === category.depth - 1) {
                            <div class="relative h-11 w-5">
                              <div class="absolute left-0 top-0 h-6 w-5 border-b-2 border-l-2 border-platinum-20 rounded-bl-lg"></div>
                            </div>
                          } @else {
                            <div class="relative h-11 w-5">
                              <div class="absolute left-0 top-0 h-full w-0.5 bg-platinum-20"></div>
                            </div>
                          }
                        }
                      </div>
                    }

                    <!-- Image -->
                    @if (category.image_url) {
                      <div
                        class="h-11 w-11 flex-shrink-0 overflow-hidden rounded-lg border"
                        [class.border-green-60]="category.depth === 0"
                        [class.border-platinum-20]="category.depth > 0"
                      >
                        <img
                          [src]="category.image_url"
                          [alt]="category.name"
                          class="h-full w-full object-cover"
                        />
                      </div>
                    } @else {
                      <div
                        class="flex h-11 w-11 flex-shrink-0 items-center justify-center rounded-lg border"
                        [class.border-green-60]="category.depth === 0"
                        [class.bg-green-10]="category.depth === 0"
                        [class.text-green-60]="category.depth === 0"
                        [class.border-platinum-20]="category.depth > 0"
                        [class.bg-platinum-10]="category.depth > 0"
                        [class.text-platinum-40]="category.depth > 0"
                      >
                        <svg
                          width="20"
                          height="20"
                          viewBox="0 0 20 20"
                          fill="none"
                        >
                          <path
                            d="M2.5 5H7.5L9.16667 2.5H15.8333C16.2754 2.5 16.6993 2.67559 17.0118 2.98816C17.3244 3.30072 17.5 3.72464 17.5 4.16667V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V5Z"
                            stroke="currentColor"
                            stroke-width="1.5"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                          />
                        </svg>
                      </div>
                    }

                    <!-- Category Info -->
                    <div class="min-w-0">
                      <p
                        class="text-platinum-100"
                        [class.font-semibold]="category.depth === 0"
                        [class.text-sm]="true"
                        [class.font-medium]="category.depth > 0"
                      >
                        {{ category.name }}
                      </p>
                      <p class="text-xs text-platinum-50">
                        ID: {{ category.id }}
                      </p>
                    </div>
                  </div>
                </td>

                <!-- Slug -->
                <td class="hidden px-4 py-3 md:table-cell">
                  <code
                    class="inline-block rounded-md bg-platinum-10 px-2 py-0.5 text-xs font-medium text-platinum-70"
                  >
                    {{ category.slug }}
                  </code>
                </td>

                <!-- Parent Category -->
                <td class="hidden px-4 py-3 lg:table-cell">
                  @if (category.parent_id) {
                    <span
                      class="inline-flex rounded-md bg-platinum-10 px-2 py-0.5 text-xs font-medium text-platinum-70"
                    >
                      ID: {{ category.parent_id }}
                    </span>
                  } @else {
                    <span class="text-xs text-platinum-40">--</span>
                  }
                </td>

                <!-- Status Toggle -->
                <td class="hidden px-4 py-3 xl:table-cell">
                  <button
                    type="button"
                    (click)="toggleCategoryStatus(category.id, category.enabled)"
                    class="relative inline-flex h-[22px] w-10 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-green-60 focus:ring-offset-2"
                    [class.bg-green-60]="category.enabled"
                    [class.bg-platinum-30]="!category.enabled"
                    [attr.aria-label]="category.enabled ? 'გამორთვა' : 'ჩართვა'"
                  >
                    <span
                      class="inline-block h-4 w-4 transform rounded-full bg-white shadow-sm transition-transform"
                      [class.translate-x-[21px]]="category.enabled"
                      [class.translate-x-[3px]]="!category.enabled"
                    ></span>
                  </button>
                </td>

                <!-- Actions -->
                <td class="px-4 py-3">
                  <div class="flex items-center justify-end gap-1">
                    <a
                      [routerLink]="['/admin/categories', category.id, 'edit']"
                      class="flex items-center justify-center rounded-lg p-2 text-platinum-40 transition-colors hover:bg-platinum-10 hover:text-platinum-80"
                      aria-label="რედაქტირება"
                    >
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                          d="M11.3333 2.00004C11.5084 1.82494 11.7163 1.68605 11.9451 1.59129C12.1739 1.49653 12.419 1.44775 12.6666 1.44775C12.9143 1.44775 13.1594 1.49653 13.3882 1.59129C13.617 1.68605 13.8249 1.82494 14 2.00004C14.1751 2.17513 14.314 2.383 14.4087 2.61178C14.5035 2.84055 14.5523 3.08569 14.5523 3.33337C14.5523 3.58106 14.5035 3.8262 14.4087 4.05497C14.314 4.28375 14.1751 4.49162 14 4.66671L5.00001 13.6667L1.33334 14.6667L2.33334 11L11.3333 2.00004Z"
                          stroke="currentColor"
                          stroke-width="1.4"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </a>
                    <button
                      type="button"
                      (click)="openDeleteModal(category.id)"
                      class="flex items-center justify-center rounded-lg p-2 text-platinum-40 transition-colors hover:bg-valencia-10 hover:text-valencia-60"
                      aria-label="წაშლა"
                    >
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path
                          d="M2 4H3.33333H14"
                          stroke="currentColor"
                          stroke-width="1.4"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                        <path
                          d="M5.33334 4.00004V2.66671C5.33334 2.31309 5.47381 1.97395 5.72386 1.7239C5.97391 1.47385 6.31305 1.33337 6.66668 1.33337H9.33334C9.68697 1.33337 10.0261 1.47385 10.2762 1.7239C10.5262 1.97395 10.6667 2.31309 10.6667 2.66671V4.00004M12.6667 4.00004V13.3334C12.6667 13.687 12.5262 14.0261 12.2762 14.2762C12.0261 14.5262 11.687 14.6667 11.3333 14.6667H4.66668C4.31305 14.6667 3.97391 14.5262 3.72386 14.2762C3.47381 14.0261 3.33334 13.687 3.33334 13.3334V4.00004H12.6667Z"
                          stroke="currentColor"
                          stroke-width="1.4"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            }
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <app-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages()"
      [totalItems]="totalCategories()"
      [showingFrom]="showingFrom()"
      [showingTo]="showingTo()"
      [limit]="limit()"
      (pageChange)="onPageChange($event)"
      (limitChange)="onLimitChangeValue($event)"
    />
  </div>
</div>

<app-confirmation-modal
  [isOpen]="isDeleteModalOpen()"
  title="კატეგორიის წაშლა"
  message="დარწმუნებული ხართ, რომ გსურთ ამ კატეგორიის წაშლა? ყველა ქვეკატეგორიაც წაიშლება. ეს მოქმედება შეუქცევადია."
  confirmText="წაშლა"
  cancelText="გაუქმება"
  confirmButtonGradientStart="#ef4444"
  confirmButtonGradientEnd="#dc2626"
  (confirm)="confirmDelete()"
  (cancel)="closeDeleteModal()"
/>
